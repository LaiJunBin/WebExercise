(function(){"use strict";var u=(e=>(e.MESSAGE="message",e.SYSTEM="system",e))(u||{}),n=(e=>(e.INIT="init",e.MESSAGE="message",e.JOIN="join",e.LEAVE="leave",e))(n||{}),S=(e=>(e.JOIN="join",e.MESSAGE="message",e.CLOSE="close",e))(S||{});const c=[],a=[],p=[];function r(e){c.forEach(o=>{o.postMessage(e)})}self.onconnect=function(e){for(let o=0;o<e.ports.length;o++)e.ports[o].onmessage=function(t){if(t.data.type===S.JOIN){const s=t.data.value;p.push(s);const E={id:a.length,type:u.SYSTEM,sender:"Server",message:`${s} joined the chat`,timestamp:Date.now()};a.push(E),r({type:n.MESSAGE,value:E}),r({type:n.JOIN,value:p})}else if(t.data.type===S.MESSAGE){const s={id:a.length,type:u.MESSAGE,sender:t.data.sender,message:t.data.value,timestamp:Date.now()};a.push(s),r({type:n.MESSAGE,value:s})}else if(t.data.type===S.CLOSE){const s=t.data.value;if(s){p.splice(p.indexOf(s),1);const E={id:a.length,type:u.SYSTEM,sender:"Server",message:`${s} left the chat`,timestamp:Date.now()};a.push(E),r({type:n.MESSAGE,value:E}),r({type:n.LEAVE,value:s})}c.splice(c.indexOf(t.target),1)}},c.push(e.ports[o]),e.ports[o].postMessage({type:n.INIT,value:a})}})();
