var E=Object.defineProperty;var b=(s,e,r)=>e in s?E(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var i=(s,e,r)=>(b(s,typeof e!="symbol"?e+"":e,r),r);import{w as u}from"./index.72801b12.js";var d=(s=>(s.MESSAGE="message",s.SYSTEM="system",s))(d||{}),a=(s=>(s.INIT="init",s.MESSAGE="message",s.JOIN="join",s.LEAVE="leave",s))(a||{}),o=(s=>(s.JOIN="join",s.MESSAGE="message",s.CLOSE="close",s))(o||{});const{subscribe:S,set:h,update:m}=u([]),n={subscribe:S,pushChat:s=>m(e=>[...e,s]),setChats:s=>h(s)},{subscribe:l,set:c}=u(null),t={subscribe:l,setUser:s=>c(s),clear:()=>c(null),get user(){return new Promise(s=>{l(e=>{s(e)})})}},{subscribe:k,update:w,set:v}=u([]),p={subscribe:k,addUser:s=>w(e=>[...e,s]),removeUser:s=>w(e=>e.filter(r=>r!==s)),setUsers:s=>v(s)};class M{constructor(){i(this,"worker",null)}init(){this.worker=new SharedWorker(new URL(""+new URL("../workers/chat-763116e0.js",import.meta.url).href,self.location),{type:"module"}),this.worker.port.onmessage=e=>{e.data.type===a.INIT?n.setChats(e.data.value):e.data.type===a.MESSAGE?n.pushChat(e.data.value):e.data.type===a.JOIN?p.setUsers(e.data.value):e.data.type===a.LEAVE&&p.removeUser(e.data.value)}}async joinChat(e){var r;t.setUser(e),this.init(),(r=this.worker)==null||r.port.postMessage({type:o.JOIN,value:await t.user})}async sendMessage(e){var r;(r=this.worker)==null||r.port.postMessage({type:o.MESSAGE,sender:await t.user,value:e})}async closeChat(){var e;(e=this.worker)==null||e.port.postMessage({type:o.CLOSE,value:await t.user}),this.worker=null,t.clear()}}const f=new M;export{d as C,p as a,n as c,t as u,f as w};
