(function(t){function e(e){for(var s,r,c=e[0],u=e[1],o=e[2],d=0,m=[];d<c.length;d++)r=c[d],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&m.push(n[r][0]),n[r]=0;for(s in u)Object.prototype.hasOwnProperty.call(u,s)&&(t[s]=u[s]);l&&l(e);while(m.length)m.shift()();return a.push.apply(a,o||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],s=!0,c=1;c<i.length;c++){var u=i[c];0!==n[u]&&(s=!1)}s&&(a.splice(e--,1),t=r(r.s=i[0]))}return t}var s={},n={app:0},a=[];function r(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=s,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/WebExercise/50屆/global/music-player/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=e,c=c.slice();for(var o=0;o<c.length;o++)e(c[o]);var l=u;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var s=i("85ec"),n=i.n(s);n.a},1062:function(t,e,i){},1707:function(t,e,i){"use strict";var s=i("2ffe"),n=i.n(s);n.a},"2b00":function(t,e,i){"use strict";var s=i("f9ca"),n=i.n(s);n.a},"2c36":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGgAAABoCAYAAAAdHLWhAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABNRJREFUeNrsne1x2kAQhpeM/0MqQK7ASgUoFZhUELmCkAqiVBBSQXAHpoLIFYRUENEBqYBox8eEwZJOd7dnjPZ9Z3bGCgoc99zex94tGu33e4Jer96gCgAIAiAAggAIAiAAgqR1JfQ+aW3z2rKTfy9r29T2gKr20yhwocpAitpmlvu2tS0A6mUBLWv75Ph/1rXlte163p+bRpAMqM65V1nVVsUExB/w0bOAv02ld0FKjLfdDNg5PptGLj5JWATAIVPpXQWbmHFryHBY38zwIOpB3LL/CBXwvXH3pi5gRnrUVg9eHlQIFqxomXRogmOtU1cP4nFjLFi465PBMmRsu2Rdt00aXDwoE4ZDZu3Uda1Fc4kuLo1QsMnJ9VgpoIkEoEmEgiUtf2tTIjnNllTV8rc2VRKANgS9uM4NaNMQZdCojQSgSrgC/9Lz4OlKIZymevAeg5aCBWt6r5UpsCYtJReqB3e8EWg1CTUHTPPafiiBYw0c+8zi5gKtfN5RKPai7wrgbKnH1osPoMpQ94V0Rx3BQSOOmH8wX2KIujcLf+vEK2TDLjGtfebgzrnHbDCh4W3Y9dZI4Gx2Zlr8bQeYpdIZWrBGwofns5DWAsUHBJ0xkgABEARAAAQBEABBAAQBEABBAKRdV4LvxeHzhP6fn6voKXKNwyZnBMRn5TiSndc2bbmH942WxnaocjeFBEvZUx46wDSByskty25iPielOAcnX1qlaaT9exUG5GH53l95z88oatvth6mytrRPPfh4ELfmX4Etibe9Vx2v82tDz3LgHiWzeZMroEP221SgcCk1H3ktavuiZIjpOt3kNc1eCMBhjak5cSlRBOdQD6Ln4iohQAe9PWk9PpnjQ9DbNi9yzQ+aChcss1xrUSbRxSURCnaaFHajFFAqASglKJZEMuxiFywBpzBAVYTP30V+/0uRyDQ7RtDzFMpWKaBKCpB07k5pudaiUmoMkkzgWje0nEIhnPsuD/IJ9VQk83sG71q6TU2L1a6Ql5cH8WCWCxTsa8eYxl6kJZl4YZsc+UyzeT/nLtClC0sjyMx9QxVPhjhBbWW7MWTDLjfd0djRc1zGGV4bzWkYm3XHk63em5ah6SeJqXDb3s3a3IfzCY6Syg+amG4pbZjfl8oXoa8CEBRJOBcHQBAAARAEQBAAARAEQAAEARAEQAB0pISeth04Ur0/sYqe9jxwps5TIcFSjmAX1H972vXpW1CABzGcktzODtwaj0odPHPV4JWXbhtyODbg40EHOL7nqPskLvEXGPov//Z5VJwXoAdq//lLl8K1eRIX+qeSHuyRLBkdrl1cJgCHjPcVLa+tFA0xM1t35+pBJck9wmxLzw/Ma+ja+tSDlwdNSPb5ctMG985Jn6YklMAVYy2TNbi8RokAyrAqucxIQoiQwGX57i6AYkQAkMBl+e7nTuDaNSxiNerVZtiVlmstKqW6uLXw/H/TEKXQpi0JPcOOJZlhV7REEbQ9aHAhOYtjV5R4OtYjtYd0ckVj0b2t1/DdDwp5jl2fKG5qGsN44HBy202+gCbGA24jwDn+jMUAF8g7M1T0mhCFpp8szFhia+mH3y0tEBtwk0R+ELf0ubHkqOs7zE5K423Y6j4TICiicOwKgCAAAiAIgCAAAiBIXP8EGAAnGenHBg2FMwAAAABJRU5ErkJggg=="},"2ffe":function(t,e,i){},3343:function(t,e,i){},"3ac7":function(t,e,i){"use strict";var s=i("ea9b"),n=i.n(s);n.a},"4c16":function(t,e,i){"use strict";var s=i("1062"),n=i.n(s);n.a},"56d7":function(t,e,i){"use strict";i.r(e);i("99af"),i("4de4"),i("d3b7"),i("25f0"),i("4d90"),i("e260"),i("e6cf"),i("cca6"),i("a79d");var s=i("2b0e"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("img",{staticStyle:{"grid-area":"logo"},attrs:{alt:"Vue logo",src:i("cf05")}}),t._l(t.components,(function(t,e){return s(t,{key:e,tag:"component",style:{gridArea:t.name.toLowerCase()},attrs:{id:t.name.toLowerCase()}})})),s("Modal",{directives:[{name:"show",rawName:"v-show",value:t.$store.modalText,expression:"$store.modalText"}],on:{close:function(e){t.$store.modalText=""}}},[t._v(t._s(t.$store.modalText))])],2)},a=[],r=(i("4160"),i("159b"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"touch",rawName:"v-touch:y",arg:"y"}]},[i("div",{staticClass:"musics"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],attrs:{type:"text",placeholder:"Search..."},domProps:{value:t.searchText},on:{input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),i("router-view"),t._l(t.musics,(function(e,s){return i("div",{key:s,staticClass:"music"},[i("button",{staticClass:"play-btn",on:{click:function(i){return t.play(e)}}},[t._v(" "+t._s(t.$store.playIs(e)&&e.playing?"⏸":"⏵")+" ")]),i("div",{staticClass:"title"},t._l(e.title,(function(e,s){return i("span",{key:s,class:{active:t.payload.title.toLowerCase().includes(e.toLowerCase())}},[t._v(t._s(e))])})),0),i("div",{staticClass:"artist"},[t._v("演唱者： "),t._l(e.artists.join(", ")||"不明",(function(e,s){return i("span",{key:s,class:{active:t.payload.artist.toLowerCase().includes(e.toLowerCase())}},[t._v(t._s(e))])}))],2),i("div",{staticClass:"album"},[t._v("專輯： "),t._l(e.albums.join(", ")||"無",(function(e,s){return i("span",{key:s,class:{active:t.payload.album.toLowerCase().includes(e.toLowerCase())}},[t._v(t._s(e))])}))],2),i("div",{staticClass:"duration"},[t._v(t._s(t._f("duration")(e.duration)))]),i("button",{staticClass:"add-btn",on:{click:function(i){return t.playlist.add(e)}}},[t._v("+")])])}))],2),i("Modal",{directives:[{name:"show",rawName:"v-show",value:t.continuePlayOpen,expression:"continuePlayOpen"}],on:{close:function(e){t.continuePlayOpen=!1}}},[t._v(" 要繼續播放嗎? "),i("div",{staticClass:"btn-group"},[i("button",{staticClass:"primary",on:{click:function(e){return t.continuePlay()}}},[t._v("Yes")]),i("button",{staticClass:"danger",on:{click:function(e){t.continuePlayOpen=!1}}},[t._v("No")])])])],1)}),c=[],u=(i("7db0"),i("caad"),i("d81d"),i("fb6a"),i("45fc"),i("b0c0"),i("c1f9"),i("ac1f"),i("2532"),i("a1f0"),i("5319"),i("2909")),o=i("5530"),l=(i("c975"),i("a15b"),i("13d5"),i("6062"),i("3ca3"),i("1276"),i("ddb0"),i("96cf"),i("1da1")),d=i("b85c"),m=(i("a434"),i("d4ec")),p=i("bee2"),f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(m["a"])(this,t),this.musics=e,this.open=!1,this.music=null}return Object(p["a"])(t,[{key:"reset",value:function(){this.music=null,A.setMusic(null)}},{key:"set",value:function(t){this.music=t,A.setMusic(t)}},{key:"clear",value:function(){this.musics.length=0,this.reset(),this.save()}},{key:"save",value:function(){localStorage.playlist=JSON.stringify(this.musics)}},{key:"add",value:function(t){this.contains(t)?A.setModalText("音樂已經存在播放清單!"):t.el?(this.musics.push(t),this.save(),this.open=!0):A.setModalText("音樂"+t.title+"無法播放,因此無法加入播放清單!")}},{key:"remove",value:function(t){var e=this.indexOf(t);this.musics.splice(e,1)}},{key:"indexOf",value:function(t){return this.musics.indexOf(t)}},{key:"contains",value:function(t){return-1!==this.indexOf(t)}},{key:"playNext",value:function(){var t=this.indexOf(this.music);t+1<this.musics.length&&(this.set(this.musics[t+1]),A.playMusic())}},{key:"playPrev",value:function(){var t=this.indexOf(this.music);t-1>=0&&(this.set(this.musics[t-1]),A.playMusic())}},{key:"isFirst",value:function(){return this.indexOf(this.music)-1<0}},{key:"isLast",value:function(){return this.indexOf(this.music)+1>=this.musics.length}},{key:"playing",get:function(){var t;return null===(t=this.music)||void 0===t?void 0:t.playing}}]),t}(),h=f,v="https://music-api.laiweb.org";function y(t){return t.lrc_path?b(t):t.srt_path?g(t):[]}function b(t){return fetch(v+"/musics/"+t.id+"/subtitles").then((function(t){return t.json()})).then((function(e){for(var i=e.data.split("\n"),s=[],n=function(t){var e,n=i[t],a=[],r=n.matchAll(/\[(\d\d):(\d\d).(\d\d)\]/g),c=[60,1,.01],u=Object(d["a"])(r);try{for(u.s();!(e=u.n()).done;){var o=e.value;n=n.replace(o[0],"");var l=o.map((function(t){return+t})).slice(1).map((function(t,e){return t*c[e]})).reduce((function(t,e){return t+e}));a.push(l)}}catch(m){u.e(m)}finally{u.f()}a.forEach((function(t){s.push({start:t,text:n})}))},a=0;a<i.length;a++)n(a);s.sort((function(t,e){return t.start-e.start}));for(var r=0;r<s.length-1;r++)s[r].end=s[r+1].start;return s[s.length-1].end=t.duration,s}))}function g(t){return fetch(v+"/musics/"+t.id+"/subtitles").then((function(t){return t.json()})).then((function(t){for(var e=t.data.split("\n"),i=[],s=0;s<e.length;s+=4)e[s]&&function(){var t=e[s+2],n=Object(u["a"])(e[s+1].matchAll(/(\d\d):(\d\d):(\d\d),(\d\d\d) --> (\d\d):(\d\d):(\d\d),(\d\d\d)/g))[0].map((function(t){return+t})),a=[3600,60,1,.001],r=n.slice(1,5).map((function(t,e){return t*a[e]})).reduce((function(t,e){return t+e})),c=n.slice(5,9).map((function(t,e){return t*a[e]})).reduce((function(t,e){return t+e}));i.push({start:r,end:c,text:t})}();return i.sort((function(t,e){return t.start-e.start})),i}))}var _=new s["a"]({data:{musics:[],listMusics:[],albums:[],music:null,playlist:new h,loading:!0,modalText:"",mediaSession:[]},methods:{updateMediaSession:function(){var t=this;this.mediaSession=this.playlist.musics.map((function(e){var i=t.albums.find((function(t){return t.title===e.albums[0]})),s=[];return i&&(s=[{sizes:"512x512",src:i.cover_path,type:"image/jpeg"}]),{artwork:s,album:e.albums.join(", ")||"無",title:e.title,artist:e.artists.join(", ")||"不明"}})),this.updateMetadata()},updateMediaPosition:function(){var t,e,i;navigator.mediaSession.setPositionState({duration:null===(t=this.music)||void 0===t?void 0:t.el.duration,currentTime:null===(e=this.music)||void 0===e?void 0:e.el.currentTime,playbackRate:null===(i=this.music)||void 0===i?void 0:i.el.playbackRate})},updateMetadata:function(){var t=this.mediaSession[this.playlist.indexOf(this.playlist.music)];navigator.mediaSession.metadata=new MediaMetadata(Object(o["a"])({},t)),this.updateMediaPosition()},setModalText:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.modalText=t},setMusic:function(){var t,e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(null===(t=this.music)||void 0===t?void 0:t.el)&&(this.pauseMusic(),this.music.currentTime=0),this.music=i,(null===(e=this.music)||void 0===e?void 0:e.el)&&(this.music.currentTime=s,this.updateMediaSession())},playIs:function(t){return this.music===t&&this.playlist.music!==t},playMusic:function(){var t;(null===(t=this.music)||void 0===t?void 0:t.el)?(this.music.el.play(),this.music.playing=!0):this.setModalText("音樂"+this.music.title+"無法播放!")},pauseMusic:function(){var t;(null===(t=this.music)||void 0===t?void 0:t.el)&&(this.music.el.pause(),this.music.playing=!1)},switchPlayStatus:function(){var t;(null===(t=this.music)||void 0===t?void 0:t.el)&&(this.music.playing?this.pauseMusic():this.playMusic())}},created:function(){var t=this;s["a"].prototype.init=Promise.all([fetch(v+"/albums").then((function(t){return t.json()})),fetch(v+"/musics").then((function(t){return t.json()}))]).then(function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(i){var s,n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=i[0].data,n=i[1].data,e.next=4,Promise.all(n.map(function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(i){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i.albums=s.filter((function(t){return t.musics.some((function(t){return t.id===i.id}))})).map((function(t){return t.title})),e.next=3,y(i);case 3:return i.subtitle=e.sent,e.abrupt("return",new Promise((function(e){var s=new Audio;s.crossOrigin="anonymous",s.src=v+"/"+i.source,i.currentTime=0,i.playing=!1,s.onloadedmetadata=function(){i.duration=s.duration,i.el=s,i.volume=.5,e(i)},s.onerror=function(){i.el=null,i.duration=0,i.volume=.5,e(i)},s.ontimeupdate=function(){i.currentTime=s.currentTime},s.onended=function(){t.playlist.playNext()}})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:s=s.map((function(t){t.musics=t.musics.map((function(t){return n.find((function(e){return e.id===t.id}))})),t.cover_path=v+"/"+t.cover_path;var e=new Set;return t.musics.forEach((function(t){t.artists.forEach((function(t){e.add(t)}))})),t.artists=Object(u["a"])(e),t.duration=t.musics.map((function(t){return t.duration})).reduce((function(t,e){return t+e})),t})),t.musics=n,t.listMusics=n,t.albums=s,a=JSON.parse(localStorage.playlist||"[]"),a=a.map((function(t){return n.find((function(e){return e.id===t.id}))})),t.playlist=new h(a),t.loading=!1,t.updateMediaSession(),navigator.mediaSession.setActionHandler("previoustrack",(function(){t.playlist.playPrev()})),navigator.mediaSession.setActionHandler("nexttrack",(function(){t.playlist.playNext()})),navigator.mediaSession.setActionHandler("play",(function(){t.switchPlayStatus()})),navigator.mediaSession.setActionHandler("pause",(function(){t.switchPlayStatus()}));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}});function x(){for(var t={},e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];for(var n=function(){var e=r[a];t[e]=function(){return _[e]}},a=0,r=i;a<r.length;a++)n();return t}var A=_,w={name:"Musics",data:function(){return{searchText:"",payload:{title:"",album:"",artist:"",composer:""},continuePlayOpen:!1}},methods:{play:function(t){this.$store.playIs(t)?(this.$store.switchPlayStatus(),t.playing?"albums"===this.$route.name&&this.$router.replace("/albums/".concat(this.$route.params.albumId,"/").concat(t.id)).catch((function(){})):"albums"===this.$route.name&&this.$router.replace("/albums/".concat(this.$route.params.albumId)).catch((function(){}))):("albums"===this.$route.name&&this.$router.replace("/albums/".concat(this.$route.params.albumId,"/").concat(t.id)).catch((function(){})),this.playlist.reset(),this.$store.setMusic(t),this.$store.playMusic())},continuePlay:function(){var t=+this.$route.params.musicId,e=this.$store.musics.find((function(e){return e.id===t}));this.$store.setMusic(e),this.$store.playMusic(),this.continuePlayOpen=!1}},computed:Object(o["a"])(Object(o["a"])({},x("playlist")),{},{musics:function(){var t=this;return this.$store.listMusics.filter((function(e){return!(!t.payload.title||!e.title.toLowerCase().includes(t.payload.title.toLowerCase()))||(!(!t.payload.artist||!e.artists.some((function(e){return e.toLowerCase().includes(t.payload.artist.toLowerCase())})))||(!(!t.payload.album||!e.albums.some((function(e){return e.toLowerCase().includes(t.payload.album.toLowerCase())})))||(!(!t.payload.composer||!e.composers.some((function(e){return e.toLowerCase().includes(t.payload.composer.toLowerCase())})))||t.searchText.length<3)))}))}}),mounted:function(){var t=this;this.init.then((function(){if("albums"===t.$route.name){var e=+t.$route.params.musicId,i=t.$store.musics.find((function(t){return t.id===e}));i&&(t.continuePlayOpen=!0)}}))},watch:{searchText:function(t){var e={title:"",album:"",artist:"",composer:""};if(this.payload=e,t.length>=3){var i=Object(u["a"])(t.matchAll(/(title|album|artist|composer):(?=")"([^"]+)|(title|album|artist|composer):(\S+)/g));i.length?e=Object.fromEntries(i.map((function(t){return t.filter((function(t){return t})).slice(1)}))):e.title=t}Object.assign(this.payload,e)}}},O=w,C=(i("5837"),i("2877")),j=Object(C["a"])(O,r,c,!1,null,"4c6b913a",null),S=j.exports,M=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"touch",rawName:"v-touch:y",arg:"y"}]},[i("div",{staticClass:"albums"},t._l(t.albums,(function(e,s){return i("router-link",{key:s,staticClass:"album",attrs:{to:"/albums/"+e.id,tag:"div"}},[i("img",{attrs:{draggable:"false",src:e.cover_path}}),i("div",[t._v(t._s(e.title))]),i("div",[t._v("演唱者： "+t._s(e.artists.join(", ")||"不明"))])])})),1)])},k=[],P={name:"Albums",computed:Object(o["a"])({},x("albums"))},$=P,E=(i("4c16"),Object(C["a"])($,M,k,!1,null,"587159cd",null)),T=E.exports,B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{height:"100%"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.music,expression:"music"}],staticStyle:{height:"100%",display:"flex","flex-direction":"column"}},[t.music?i("div",[t._v("當前播放： "+t._s(t.music.title))]):t._e(),i("canvas",{ref:"cvs",staticStyle:{flex:"1"}}),i("div",{staticClass:"subtitle"},[t._v(t._s(t.subtitle))]),t.music?i("div",{staticClass:"btn-group circles"},[t.playlist.musics.length>1&&t.playlist.music?i("button",{class:{disabled:t.playlist.isFirst()},on:{click:function(e){return t.playlist.playPrev()}}},[t._v(" ⏪︎ ")]):t._e(),i("button",{staticStyle:{width:"50px",height:"50px"},on:{click:function(e){return t.$store.switchPlayStatus()}}},[t._v(" "+t._s(t.music.playing?"⏸":"⏵")+" ")]),t.playlist.musics.length>1&&t.playlist.music?i("button",{class:{disabled:t.playlist.isLast()},on:{click:function(e){return t.playlist.playNext()}}},[t._v(" ⏩︎ ")]):t._e()]):t._e()]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.music,expression:"!music"}],staticStyle:{display:"flex","align-items":"center","justify-content":"center",height:"100%","font-size":"40px"}},[t._v(" 當前沒有播放的音樂 ")]),i("Modal",{directives:[{name:"show",rawName:"v-show",value:t.continuePlayOpen,expression:"continuePlayOpen"}],on:{close:function(e){t.continuePlayOpen=!1}}},[t._v(" 要繼續播放嗎? "),i("div",{staticClass:"btn-group"},[i("button",{staticClass:"primary",on:{click:function(e){return t.continuePlay()}}},[t._v("Yes")]),i("button",{staticClass:"danger",on:{click:function(e){t.continuePlayOpen=!1}}},[t._v("No")])])])],1)},L=[],R=(i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),{name:"Player",data:function(){return{frame:0,subtitle:"",cvs:null,ctx:null,continuePlayOpen:!1}},methods:{setSize:function(){this.cvs.width=0,this.cvs.height=0,this.cvs.width=this.cvs.clientWidth,this.cvs.height=this.cvs.clientHeight},render:function(){var t;if(this.setSize(),null===(t=this.music)||void 0===t?void 0:t.el){var e;this.frame++;var i=this.music.currentTime;if(this.frame%100===0&&"playlist"===this.$route.name){var s=this.music.playing?"playing":"paused";this.$router.replace("/playlist/".concat(this.music.id,"/").concat(i,"/").concat(s)).catch((function(){}))}this.music.ctx||(this.music.ctx=new AudioContext,this.music.analyser=this.music.ctx.createAnalyser(),this.music.source=this.music.ctx.createMediaElementSource(this.music.el),this.music.analyser.connect(this.music.ctx.destination),this.music.source.connect(this.music.analyser)),this.subtitle=null===(e=this.music.subtitle.find((function(t){return t.start<=i&&i<=t.end})))||void 0===e?void 0:e.text;var n=new Uint8Array(this.music.analyser.frequencyBinCount);this.music.analyser.getByteFrequencyData(n),n=n.slice(0,600);var a=this.cvs.width/n.length,r=this.cvs.height/255;this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height);for(var c=0;c<n.length;c+=10){var u=a*c,o=n[c]*r;this.ctx.save(),this.ctx.fillStyle="#39f",this.ctx.translate(u,this.cvs.height),this.ctx.fillRect(0,0,10*a,-o),this.ctx.restore()}}requestAnimationFrame(this.render)},continuePlay:function(){var t=+this.$route.params.musicId,e=this.$store.musics.find((function(e){return e.id===t})),i=+this.$route.params.time,s=this.$route.params.status;this.$store.setMusic(e,i),"playing"===s&&this.$store.playMusic(),this.continuePlayOpen=!1}},computed:Object(o["a"])({},x("music","playlist")),mounted:function(){var t=this;this.init.then((function(){if(t.cvs=t.$refs.cvs,t.ctx=t.cvs.getContext("2d"),t.setSize(),"playlist"===t.$route.name){var e=+t.$route.params.musicId,i=t.$store.musics.find((function(t){return t.id===e}));i&&(t.continuePlayOpen=!0),requestAnimationFrame(t.render)}else requestAnimationFrame(t.render)}))}}),N=R,I=(i("2b00"),Object(C["a"])(N,B,L,!1,null,"691acb6b",null)),H=I.exports,F=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.music?i("div",[i("div",{staticStyle:{display:"flex"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.music.currentTime,expression:"music.currentTime"}],staticStyle:{flex:"1","margin-right":"10px"},attrs:{type:"range",min:"0",max:t.music.duration},domProps:{value:t.music.currentTime},on:{__r:function(e){return t.$set(t.music,"currentTime",e.target.value)}}}),t._v(" "+t._s(t._f("duration")(t.music.currentTime))+" / "+t._s(t._f("duration")(t.music.duration))+" ")]),i("div",{staticStyle:{"text-align":"right"}},[t._v(" 音量："),i("input",{directives:[{name:"model",rawName:"v-model",value:t.music.volume,expression:"music.volume"}],attrs:{type:"range",min:"0",max:"1",step:"0.01"},domProps:{value:t.music.volume},on:{__r:function(e){return t.$set(t.music,"volume",e.target.value)}}})])]):t._e()},Q=[],W={name:"Player-Control",computed:Object(o["a"])({},x("music")),watch:{"music.currentTime":function(t){this.music.el.currentTime=t},"music.volume":function(t){this.music.el.volume=t}}},V=W,z=(i("1707"),Object(C["a"])(V,F,Q,!1,null,"0683a106",null)),G=z.exports,J=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.$store.music?i("div",{staticClass:"info"},[t._m(0),i("div",[i("div",[t._v(t._s(t.$store.music.title))]),i("div",[t._v(t._s(t._f("duration")(t.$store.music.duration)))]),i("div",[t._v("演唱者: "+t._s(t.$store.music.artists.join(", ")||"不明"))])])]):i("div",[t._v(" 當前沒有播放的音樂 ")])])},X=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",[t._v("當前播放")])])}],U={name:"Player-Info"},Y=U,Z=(i("84af"),Object(C["a"])(Y,J,X,!1,null,"2fe797a8",null)),q=Z.exports,D=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{style:{width:t.playlist.open?"400px":"25px"},attrs:{id:"playlist"}},[s("div",{staticClass:"switch",on:{click:function(e){t.playlist.open=!t.playlist.open}}},[s("img",{attrs:{src:i("2c36"),alt:"menu icon",width:"20"}})]),s("div",{directives:[{name:"touch",rawName:"v-touch:y",arg:"y"}],staticClass:"playlist"},t._l(t.musics,(function(e,i){return s("div",{key:i,staticClass:"music",class:{active:t.playlist.music===e&&t.playlist.music===e&&e.playing},on:{click:function(i){return t.play(e)}}},[s("div",{staticClass:"no"},[t._v(t._s(i+1))]),s("div",{staticClass:"title"},[t._v(t._s(e.title))]),s("div",{staticClass:"artist"},[t._v("演唱者："+t._s(e.artists.join(", ")||"不明"))]),s("div",{staticClass:"album"},[t._v("專輯："+t._s(e.albums.join(", ")||"無"))]),s("div",{staticClass:"duration"},[t._v(t._s(t._f("duration")(e.duration)))]),s("button",{directives:[{name:"show",rawName:"v-show",value:t.playlist.music!==e||!e.playing,expression:"playlist.music !== music || !music.playing"}],staticClass:"delete-btn",on:{click:function(i){return i.stopPropagation(),t.playlist.remove(e)}}},[t._v("x ")])])})),0)])},K=[],tt={name:"Playlist",methods:{play:function(t){this.playlist.music!==t?(this.playlist.set(t),this.$store.playMusic(),this.$router.push("/playlist/".concat(t.id)).catch((function(){}))):this.$store.switchPlayStatus()}},computed:Object(o["a"])(Object(o["a"])({},x("playlist")),{},{musics:function(){return this.playlist.musics}})},et=tt,it=(i("3ac7"),Object(C["a"])(et,D,K,!1,null,"33972a64",null)),st=it.exports,nt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.$store.loading,expression:"$store.loading"}],attrs:{id:"loading"}},[i("div",{staticClass:"box"}),i("div",{staticClass:"box"}),i("div",{staticClass:"box"})])},at=[],rt={name:"Loading"},ct=rt,ut=(i("8b9b"),Object(C["a"])(ct,nt,at,!1,null,"3d892d19",null)),ot=ut.exports,lt={name:"App",data:function(){return{components:[S,T,H,G,q,st,ot]}},methods:{init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;e.$options.updated=[this.assignGridArea],e.$nextTick(this.assignGridArea),e.$children.forEach((function(e){t.init(e)}))},assignGridArea:function(){this.$el.querySelectorAll&&this.$el.querySelectorAll("*").forEach((function(t){t.className&&(t.style.gridArea=t.className)}))}},mounted:function(){this.init()}},dt=lt,mt=(i("034f"),Object(C["a"])(dt,n,a,!1,null,null,null)),pt=mt.exports,ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"modal",on:{click:function(e){return e.target!==e.currentTarget?null:t.$emit("close")}}},[i("div",{staticClass:"content"},[t._t("default")],2)])},ht=[],vt={name:"Modal"},yt=vt,bt=(i("ae58"),Object(C["a"])(yt,ft,ht,!1,null,"38d45058",null)),gt=bt.exports,_t=i("8c4f"),xt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.album?i("div",[i("img",{attrs:{draggable:"false",src:t.album.cover_path}}),i("div",[i("router-link",{attrs:{to:"/",tag:"button"}},[t._v("←")]),t._v(" "+t._s(t.album.title)+" "),i("button",{staticClass:"play-btn",on:{click:function(e){return t.play()}}},[t._v("⏵")])],1),i("div",[t._v("建立時間： "+t._s(t._f("date")(t.album.created_at)))]),i("div",[t._v("演唱者： "+t._s(t.album.artists.join(", ")||"不明"))]),i("div",[t._v(" "+t._s(t.album.musics.length)+"首歌 | "+t._s(t._f("duration")(t.album.duration))+"分鐘")]),i("div",[t._v(" "+t._s(t.album.description))]),i("Modal",{directives:[{name:"show",rawName:"v-show",value:t.confirmOpen,expression:"confirmOpen"}],on:{close:function(e){t.confirmOpen=!1}}},[t._v(" 確定覆蓋當前的播放清單嗎? "),i("div",{staticClass:"btn-group"},[i("button",{staticClass:"primary",on:{click:function(e){return t.play(!0)}}},[t._v("Yes")]),i("button",{staticClass:"danger",on:{click:function(e){t.confirmOpen=!1}}},[t._v("No")])])])],1):t._e()},At=[],wt={name:"Album",data:function(){return{confirmOpen:!1}},computed:Object(o["a"])(Object(o["a"])({},x("playlist")),{},{album:function(){var t=+this.$route.params.albumId,e=this.$store.albums.find((function(e){return e.id===t}));return e&&this.setMusics(e),e}}),methods:{setMusics:function(t){this.$store.listMusics=t.musics},play:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!e&&this.playlist.musics.length>0?this.confirmOpen=!0:(this.confirmOpen=!1,this.playlist.clear(),this.album.musics.forEach((function(e){t.playlist.add(e)})),this.playlist.set(this.playlist.musics[0]),this.$store.playMusic())}},beforeDestroy:function(){this.$store.listMusics=this.$store.musics}},Ot=wt,Ct=Object(C["a"])(Ot,xt,At,!1,null,"75f9f86d",null),jt=Ct.exports,St=[{path:"/"},{path:"/albums/:albumId/:musicId?",component:jt,name:"albums"},{path:"/playlist/:musicId?/:time?/:status?",name:"playlist"}],Mt=new _t["a"]({routes:St,mode:"history",base:"/WebExercise/50屆/global/music-player"});s["a"].use(_t["a"]),s["a"].config.productionTip=!1,s["a"].filter("duration",(function(t){var e=Math.floor(t/60||0).toString().padStart(2,"0"),i=Math.floor(t%60||0).toString().padStart(2,"0");return e+":"+i})),s["a"].filter("date",(function(t){var e=new Date(t),i=e.getFullYear(),s=e.getMonth().toString().padStart(2,"0"),n=e.getDay().toString().padStart(2,"0"),a=e.getHours().toString().padStart(2,"0"),r=e.getMinutes().toString().padStart(2,"0"),c=e.getSeconds().toString().padStart(2,"0");return"".concat(i,"-").concat(s,"-").concat(n," ").concat(a,":").concat(r,":").concat(c)})),s["a"].directive("touch",(function(t,e){var i=e.arg.toUpperCase();t.style["overflow".concat(i)]="scroll",t.addEventListener("mousedown",(function(){t.dataset.touched="true"})),window.addEventListener("mousemove",(function(e){"true"===t.dataset.touched&&(t.scrollLeft-=e.movementX,t.scrollTop-=e.movementY)})),window.addEventListener("mouseup",(function(){t.dataset.touched="false"}))})),s["a"].prototype.$store=A,s["a"].component("Modal",gt),new s["a"]({render:function(t){return t(pt)},router:Mt}).$mount("#app")},5837:function(t,e,i){"use strict";var s=i("d889"),n=i.n(s);n.a},"84af":function(t,e,i){"use strict";var s=i("9917"),n=i.n(s);n.a},"85ec":function(t,e,i){},"8b9b":function(t,e,i){"use strict";var s=i("3343"),n=i.n(s);n.a},9917:function(t,e,i){},ae58:function(t,e,i){"use strict";var s=i("e585"),n=i.n(s);n.a},cf05:function(t,e,i){t.exports=i.p+"img/logo.f4ec44e2.png"},d889:function(t,e,i){},e585:function(t,e,i){},ea9b:function(t,e,i){},f9ca:function(t,e,i){}});
//# sourceMappingURL=app.61e79ca5.js.map